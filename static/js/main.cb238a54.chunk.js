(this["webpackJsonpchoral-tracks"]=this["webpackJsonpchoral-tracks"]||[]).push([[0],{56:function(e,t,n){},60:function(e,t,n){},62:function(e,t,n){},63:function(e,t,n){},64:function(e,t,n){},68:function(e,t,n){},69:function(e,t,n){},84:function(e,t,n){},86:function(e,t,n){},87:function(e,t,n){},88:function(e,t,n){},89:function(e,t,n){},90:function(e,t,n){},91:function(e,t,n){},92:function(e,t,n){},94:function(e,t,n){"use strict";n.r(t);var r=n(0),a=n(26),c=n.n(a),o=n(1),s=n(24),i=n(11),u=n(6),l=(n(56),n(2)),d=n(5),f=n(41),b=n.n(f),j=(n(59),n(60),n(3));var p=function(e){return Object(j.jsx)("button",{className:function(){var t=e.selected?" selected":"";return"full-choir"===e.role?"PreferenceBtn full-choir"+t:"PreferenceBtn"+t}(),onClick:function(){e.handler(e.partName),e.setSelectedPreference({role:e.role,partName:e.partName})},children:e.content})};n(62);var h=function(e){var t=Object(r.useState)({role:"full-choir",partName:null}),n=Object(u.a)(t,2),a=n[0],c=n[1],o=function(e,t){return"full-choir"===a.role&&"full-choir"===e||a.role===e&&a.partName===t};return Object(j.jsxs)("div",{className:"Preferences",style:{gridTemplateColumns:"repeat (".concat(e.parts.length,", auto)")},children:[Object(j.jsx)("span",{children:"Emphasize"}),e.parts.map((function(t){return Object(j.jsx)(p,{partName:t.name,content:t.initial,role:"emphasize",handler:e.emphasizePart,selected:o("emphasize",t.name),setSelectedPreference:c},"emphasize-".concat(t.name))})),Object(j.jsx)("span",{children:"Isolate"}),e.parts.map((function(t){return Object(j.jsx)(p,{partName:t.name,content:t.initial,role:"isolate",handler:e.isolatePart,selected:o("isolate",t.name),setSelectedPreference:c},"isolate-".concat(t.name))})),Object(j.jsx)("div",{className:"full-choir-container",style:{gridColumn:"2 / ".concat(e.parts.length+2)},children:Object(j.jsx)(p,{onClick:e.fullChoir,selected:o("full-choir"),role:"full-choir",content:"Full Choir",handler:e.fullChoir,setSelectedPreference:c})})]})};n(63);var O=function(e){var t=Object(r.useState)(0),n=Object(u.a)(t,2),a=n[0],c=n[1],o=Object(r.useState)(0),s=Object(u.a)(o,2),i=s[0],l=s[1],d=Object(r.useRef)();return Object(r.useEffect)((function(){var e=window.getComputedStyle(d.current).getPropertyValue("width");l(parseInt(e.slice(0,3)))}),[]),Object(r.useEffect)((function(){var t=e.timestamp/e.duration*i;c(t)}),[e.timestamp]),Object(j.jsx)("div",{className:"ProgressMeter",ref:d,onClick:function(t){var n=t.target.getBoundingClientRect(),r=(t.clientX-n.x)/i*e.duration;e.seekTrack(r)},children:Object(j.jsx)("div",{className:"progress-bar",style:{width:a}})})},g=n(43),m=n.n(g),v=n(42),x=n.n(v),y=n(44),w=n.n(y);n(64);var S=function(e){var t=function(t){32===t.keyCode&&e.pauseTrack()};return Object(j.jsxs)("div",{className:"Controls",children:[Object(j.jsx)("button",{className:"control-btn",onClick:e.resetTrack,children:Object(j.jsx)(w.a,{})}),e.playing?Object(j.jsx)("button",{className:"control-btn",onClick:e.pauseTrack,onKeyUp:t,children:Object(j.jsx)(x.a,{})}):Object(j.jsx)("button",{className:"control-btn",onClick:e.playTrack,children:Object(j.jsx)(m.a,{})}),Object(j.jsx)("div",{className:"progress-meter-container",children:Object(j.jsx)(O,{seekTrack:e.seekTrack,duration:e.duration,timestamp:e.timestamp})})]})},k=(n(68),"https://choral-tracks-rails.up.railway.app/api");function N(){return N=Object(d.a)(Object(l.a)().mark((function e(t){var n,r,a,c,s,i=arguments;return Object(l.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=i.length>1&&void 0!==i[1]?i[1]:{},r=n.timeout,a=new AbortController,c=setTimeout((function(){return a.abort()}),r),e.next=6,fetch(t,Object(o.a)({signal:a.signal},n));case 6:return s=e.sent,clearTimeout(c),e.abrupt("return",s);case 9:case"end":return e.stop()}}),e)}))),N.apply(this,arguments)}var C=function(e){return N.apply(this,arguments)};function E(){return E=Object(d.a)(Object(l.a)().mark((function e(t,n){var r,a,c,o,s,i=arguments;return Object(l.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=i.length>2&&void 0!==i[2]?i[2]:{},c=r?r.timeout:null,e.prev=2,!(c>0)){e.next=9;break}return e.next=6,C(t,r);case 6:a=e.sent,e.next=12;break;case 9:return e.next=11,fetch(t,r);case 11:a=e.sent;case 12:e.next=18;break;case 14:throw e.prev=14,e.t0=e.catch(2),e.t0.isNetworkError=!0,e.t0;case 18:return e.next=20,a[n]();case 20:if(o=e.sent,!a.ok){e.next=25;break}return e.abrupt("return",o);case 25:if(401!==a.status){e.next=31;break}throw(s=new Error(a.message)).isUnauthorized=!0,s;case 31:throw a.bodyContent=o,console.log(a),new Error("Software Bug");case 34:case"end":return e.stop()}}),e,null,[[2,14]])}))),E.apply(this,arguments)}var P=function(e,t){return E.apply(this,arguments)};function I(){return(I=Object(d.a)(Object(l.a)().mark((function e(t,n){var r;return Object(l.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r="".concat(k,"/songs/").concat(t,"/parts"),e.next=3,P(r,"json",{timeout:2e3,signal:n});case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var T=function(e,t){return I.apply(this,arguments)};function D(){return(D=Object(d.a)(Object(l.a)().mark((function e(t){var n,r,a;return Object(l.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(n=t.split(".")).splice(n.length-1,1,"mp3"),r=n.join("."),a=new Request(r),e.next=6,P(a,"arrayBuffer",{timeout:8e3});case 6:return e.abrupt("return",e.sent);case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var A=function(e){return D.apply(this,arguments)};var F=function(e){var t=Object(r.useState)(1e4),n=Object(u.a)(t,2),a=n[0],c=n[1],o=Object(r.useState)(0),s=Object(u.a)(o,2),i=s[0],f=s[1],p=Object(r.useState)(!1),O=Object(u.a)(p,2),g=O[0],m=O[1],v=Object(r.useState)(!0),x=Object(u.a)(v,2),y=x[0],w=x[1],k=Object(r.useState)([]),N=Object(u.a)(k,2),C=N[0],E=N[1],P=Object(r.useState)(!1),I=Object(u.a)(P,2),D=I[0],F=I[1],M=Object(r.useRef)({data:{},gainNodes:{},sourceNodes:{},loaded:{}}),z=Object(r.useRef)({ctx:e.audioContext,time:0}),B=Object(r.useRef)(),R=function(){var e=Object(d.a)(Object(l.a)().mark((function e(t){var n;return Object(l.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,A(t.recording_url);case 2:return n=e.sent,e.abrupt("return",z.current.ctx.decodeAudioData(n,(function(e){return M.current.loaded[t.name]=!0,console.log(t.name,"loaded"),U()&&w(!1),e})));case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),U=function(){return Object.values(M.current.loaded).length===C.length},L=function(){g||(C.forEach((function(e){!function(e){M.current.data[e.name].then((function(t){var n=z.current.ctx.createBufferSource();M.current.sourceNodes[e.name]=n,n.buffer=t,n.connect(M.current.gainNodes[e.name]),M.current.gainNodes[e.name].connect(z.current.ctx.destination),n.start(0,i),console.log("Playing AudioBuffer",t,z.current.ctx),n.onended=function(){console.log("Ended")}}))}(e)})),m(!0))},_=function(){g&&(C.forEach((function(e){console.log("Stopping"),M.current.sourceNodes[e.name].stop(),console.log("Stopped playing ",M.current.sourceNodes[e.name])})),m(!1))},q=function(){_(),f(0)};Object(r.useEffect)((function(){D&&(L(),F(!1))}),[D]);var H=function(e){C.forEach((function(t){t.name===e?M.current.gainNodes[t.name].gain.value=1:M.current.gainNodes[t.name].gain.value=.15}))},J=function(e){C.forEach((function(t){t.name===e?M.current.gainNodes[t.name].gain.value=1:M.current.gainNodes[t.name].gain.value=0}))},G=function(){C.forEach((function(e){M.current.gainNodes[e.name].gain.value=1}))},K=function(){var t=Object(d.a)(Object(l.a)().mark((function t(){var n;return Object(l.a)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,T(e.id);case 2:n=t.sent,E(n);case 4:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}();return Object(r.useEffect)((function(){var e=M.current.sourceNodes;return K(),function(){Object.values(e).forEach((function(e){return e.stop()}))}}),[]),Object(r.useEffect)((function(){C.length>0&&(C.forEach((function(e){M.current.data[e.name]=R(e),M.current.gainNodes[e.name]=z.current.ctx.createGain()})),Object.values(M.current.data)[0].then((function(e){return c(e.duration)})))}),[C]),Object(r.useEffect)((function(){return g?(z.current.previousTime=z.current.ctx.currentTime,B.current=setInterval((function(){var e=z.current.ctx.currentTime-z.current.previousTime;z.current.previousTime=z.current.ctx.currentTime,f((function(t){return t+e}))}),250)):clearInterval(B.current),function(){return clearInterval(B.current)}}),[g]),Object(r.useEffect)((function(){i>a&&q()}),[i]),Object(j.jsxs)("div",{className:"Song",children:[Object(j.jsx)("h2",{className:"song-title",children:e.title}),Object(j.jsx)("span",{className:"loading-message",children:y?"Loading song (this might take a bit)":""}),Object(j.jsxs)(b.a,{loading:y,children:[Object(j.jsx)(S,{playTrack:L,resetTrack:q,pauseTrack:_,seekTrack:function(e){g&&F(!0),_(),f(e)},timestamp:i,duration:a,playing:g}),Object(j.jsx)("span",{className:"parts",children:"Parts: ".concat(C.map((function(e){var t=e.name;return t.charAt(0)+t.slice(1)})).join(", "))}),function(){if(C.length>1)return Object(j.jsx)(h,{parts:C,emphasizePart:H,isolatePart:J,fullChoir:G})}()]})]})};n(69);var M=function(e){return Object(j.jsx)("button",{className:"SongBtn",onClick:function(){return e.setSelectedSong(e.id)},children:e.title})},z=n(50);var B=function e(t){return"/"!==t.charAt(t.length-1)?t:e(t.slice(0,-1))},R=Object(r.createContext)();function U(){return(U=Object(d.a)(Object(l.a)().mark((function e(t,n){var r;return Object(l.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r="".concat(k,"/choirs/").concat(t),e.next=3,P(r,"json",{timeout:8e3,signal:n});case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var L=function(e,t){return U.apply(this,arguments)};var _=function(e){var t=Object(r.useState)({}),n=Object(u.a)(t,2),a=n[0],c=n[1],o=Object(r.useState)(null),i=Object(u.a)(o,2),f=i[0],b=i[1],p=Object(r.useState)(new z.a),h=Object(u.a)(p,1)[0],O=Object(r.useContext)(R),g=Object(u.a)(O,1)[0],m=function(){var e=Object(d.a)(Object(l.a)().mark((function e(t){var n;return Object(l.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,L(g,t.signal);case 3:n=e.sent,c(n),e.next=10;break;case 7:e.prev=7,e.t0=e.catch(0),console.log(e.t0);case 10:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(t){return e.apply(this,arguments)}}();return Object(r.useEffect)((function(){var e=new AbortController;return m(e),function(){return e.abort()}}),[]),Object(j.jsxs)("div",{className:"Home",children:[Object(j.jsx)(s.b,{to:"".concat(B(e.match.url),"/edit"),children:Object(j.jsx)("button",{className:"nav-btn",children:"Edit"})}),Object(j.jsx)("h1",{children:a.choir_details?a.choir_details.name:""}),Object(j.jsxs)("section",{id:"overview",children:[Object(j.jsx)("p",{children:a.choir_details?a.choir_details.message:""}),Object(j.jsx)("p",{id:"disclaimer",children:'NB: \u2002 This player may not work on a mobile device. \xa0 Also, you may find that you get the best experience using headphones, especially when selecting "emphasize".'})]}),function(){if(a.songs)return a.songs.map((function(e){return function(e){return e.id===f?Object(j.jsx)(F,{title:e.title,id:e.id,audioContext:h},e.id):Object(j.jsx)(M,{title:e.title,id:e.id,setSelectedSong:b},e.title+e.id)}(e)}))}()]})},q=Object(r.createContext)(),H=n(36);var J=function(e){var t=e.token,n=e.setToken,r=e.targetPath,a=e.children,c=function(e){if(e.error.isUnauthorized)return Object(j.jsx)(o,{})},o=function(){return Object(j.jsx)(i.a,{to:{pathname:"../../login",state:{setToken:n,targetPath:r}}})};return t?Object(j.jsx)(q.Provider,{value:t,children:Object(j.jsx)(H.ErrorBoundary,{FallbackComponent:c,children:a})}):Object(j.jsx)(o,{})},G=n(9),K=n(20),V=n(21);n(84);var X,Q=function(e){var t=Object(r.useState)("new"===e.mode),n=Object(u.a)(t,2),a=n[0],c=n[1],o=function(){c(!0)},s=function(){c(!1)};return Object(j.jsx)("div",{className:"RecordingInput",children:"new"===e.mode?Object(j.jsx)("input",{type:"file",accept:"audio/*",name:"recording",onChange:e.handleFileUpload,required:!0}):a&&"edit"===e.mode?Object(j.jsxs)("div",{className:"override-recording",children:[Object(j.jsx)("input",{type:"file",accept:"audio/*",name:"recording",onChange:e.handleFileUpload,required:!0}),Object(j.jsx)("button",{className:"revert-btn",onClick:s,children:"Revert to Existing Recording"})]}):Object(j.jsx)("button",{type:"button",onClick:o,children:"Override Recording"})})},W=n(49),Y=n.n(W),Z=V.a.button(X||(X=Object(K.a)(["\n  padding: 0;\n  width: 24px;\n  height: 24px;\n  border: none;\n  background-color: rgb(90, 87, 87);\n  border-radius: 5px;\n  color: #fff;\n  cursor: pointer;\n"])));var $,ee=function(e){var t=e.onClick;return Object(j.jsx)(Z,{type:"button",onClick:t,children:Object(j.jsx)(Y.a,{})})},te=(n(86),n(30)),ne=V.a.div($||($=Object(K.a)(["\n  position: absolute;\n  right: 5px;\n"])));var re=function(e){var t=function(){e.removePart(e.index)},n=function(t){e.updatePart(e.index,t.target.name,t.target.value)},r=function(t){e.updatePart(e.index,t.target.name,t.target.files[0])};return Object(j.jsx)(te.b,{draggableId:e.part.key,index:e.index,disabled:e.noDrag,children:function(a){return Object(j.jsxs)("li",Object(o.a)(Object(o.a)(Object(o.a)({className:"edit"===e.part.mode?"PartFormlet edit-part":"PartFormlet"},a.draggableProps),a.dragHandleProps),{},{ref:a.innerRef,children:[Object(j.jsx)(ne,{children:Object(j.jsx)(ee,{className:"remove-part-btn",onClick:t})}),Object(j.jsxs)("div",{className:"part-formlet-content",children:[Object(j.jsx)("h4",{className:"part-number",children:"Part ".concat(e.index+1)}),Object(j.jsx)("input",{type:"text",name:"name",className:"text-input",placeholder:"Name",value:e.part.name,onChange:n,required:!0}),Object(j.jsx)("input",{type:"text",name:"initial",className:"text-input initial-input",placeholder:"Initial",value:e.part.initial,onChange:n,required:!0}),Object(j.jsx)(Q,{mode:e.part.mode,handleFileUpload:r})]})]}))}})},ae=n(38),ce=n.n(ae);var oe=function(e){var t=["initial","name","recording","pitch_order"],n=e?Object(o.a)(Object(o.a)({},e),{},{recording:"existing",mode:"edit",key:ce()()}):Object(o.a)(Object(o.a)({},t.reduce((function(e,t){return e[t]="",e}),{})),{},{mode:"new",key:ce()()});return Object(o.a)(Object(o.a)({},n),{},{data:function(){var e=this,n=new FormData;return t.forEach((function(t){n.append(t,e[t])})),n},addPitchOrder:function(e){this.pitch_order=e}})};n(87);function se(){return(se=Object(d.a)(Object(l.a)().mark((function e(t,n,r){return Object(l.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,P("".concat(k,"/songs/").concat(t),"json",{method:"delete",headers:{Authorization:"Bearer ".concat(n)},timeout:3e3,signal:r});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var ie=function(e,t,n){return se.apply(this,arguments)};function ue(){return(ue=Object(d.a)(Object(l.a)().mark((function e(t,n,r,a){return Object(l.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log(r),e.next=3,P("".concat(k,"/songs/").concat(t,"/parts/").concat(n),"json",{method:"delete",headers:{Authorization:"Bearer ".concat(r)},timeout:3e3,signal:a});case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var le=function(e,t,n,r){return ue.apply(this,arguments)};var de=function(e){var t,n=new AbortController,r=[];function a(e,t){return{data:e,id:t,abortController:new AbortController,sent:!1}}function c(){return t.id?"".concat(k,"/songs/").concat(t.id):"".concat(k,"/songs")}function o(e){return e.id?"".concat(k,"/songs/").concat(t.id,"/parts/").concat(e.id):"".concat(k,"/songs/").concat(t.id,"/parts")}function s(t,r){return{method:(a=t.id,a?"patch":"post"),body:t.data,headers:{Authorization:"Bearer ".concat(e)},signal:n.signal,timeout:r};var a}function i(){return(i=Object(d.a)(Object(l.a)().mark((function e(){var n;return Object(l.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0!==t){e.next=2;break}throw new Error("Song not registered");case 2:return s(t,3e3),e.next=5,P(c(),"json",s(t,3e3));case 5:return n=e.sent,t.id||(t.id=n.id),e.abrupt("return",n);case 8:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function u(){return(u=Object(d.a)(Object(l.a)().mark((function e(){var n,a;return Object(l.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=4;break}throw new Error("No song registered");case 4:if(t.id){e.next=8;break}throw new Error("Cannot send part: song not yet created");case 8:if(0!==r.length){e.next=12;break}throw new Error("No parts registered");case 12:if(!r.every((function(e){return e.sent}))){e.next=14;break}throw new Error("Cannot send part: all parts already sent");case 14:return n=r.filter((function(e){return!e.sent})),(a=n[0]).sent=!0,e.next=19,P(o(a),"json",s(a,15e3));case 19:return e.abrupt("return",e.sent);case 20:case"end":return e.stop()}}),e)})))).apply(this,arguments)}return{addSong:function(e,n){if(t)throw new Error("Song already registered");return(t=a(e,n)).abortController},addPart:function(e,t){var n=a(e,t);return r.push(n),n.abortController},sendSong:function(){return i.apply(this,arguments)},sendNextPart:function(){return u.apply(this,arguments)},get hasNextPart(){return!r.every((function(e){return e.sent}))}}};var fe=function e(t,n){var r=function(){return Object.freeze(t.map(Object.freeze))};return Object.freeze({get:function(){return t&&t.length>0?r():n?(t=[n()],r()):[]},add:function(n){return e([].concat(Object(G.a)(t),[n]))},remove:function(n){if(t.length>1){var r=Object(G.a)(t);return r.splice(n,1),e(r)}return this},change:function(n,r,a){return e(t.map((function(e,t){if(t===n){var c=Object(o.a)({},e);return c[r]=a,c}return e})))},findIndex:function(e,n){t.findIndex((function(t){return t[e]===n}))},move:function(n,r){var a=t[n];return t.splice(n,1),t.splice(r,0,a),e(t)}})};var be=function(e){var t=Object(r.useState)((function(){var t=e.editableParts?e.editableParts.map(oe):[];return fe(t,oe)})),n=Object(u.a)(t,2),a=n[0],c=n[1],s=Object(r.useState)((function(){return"edit"===e.statusInfo.factoryMode?e.editableSong.title:""})),i=Object(u.a)(s,2),f=i[0],b=i[1],p=Object(r.useState)([]),h=Object(u.a)(p,2),O=h[0],g=h[1],m=Object(r.useContext)(q),v=Object(r.useContext)(R),x=function(e){return c((function(t){return t.remove(e)}))},y=function(e,t,n){c((function(r){return r.change(e,t,n)}))},w=function(t){e.setLoadings((function(e){return e={},t.forEach((function(t){e[t.name]={success:!1,mode:t.mode}})),Object(o.a)({},e)}))},S=function(t){e.setLoadings((function(e){return e[t].success=!0,Object(o.a)({},e)}))},k=function(){var t=function(){var t=Object.values(e.editableParts),n=a.get().filter((function(e){return e.id})).map((function(e){return e.id}));return t.filter((function(e){return!n.includes(e.id)}))}();e.setLoadings((function(e){return t.forEach((function(t){e[t.name]={success:!1,mode:"destroy"}})),Object(o.a)({},e)})),t.forEach((function(t){C(e.editableSong.id,t)}))},N=function(){var t=Object(d.a)(Object(l.a)().mark((function t(){var n;return Object(l.a)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e.setStatusInfo((function(e){return e.setDestroy()})),t.prev=1,n=new AbortController,g((function(e){return[].concat(Object(G.a)(e),[n])})),t.next=6,ie(e.editableSong.id,m,n.signal);case 6:e.setStatusInfo((function(e){return e.setSuccess()})),t.next=13;break;case 9:t.prev=9,t.t0=t.catch(1),console.log(t.t0),e.setStatusInfo((function(e){return e.setFailure()}));case 13:case"end":return t.stop()}}),t,null,[[1,9]])})));return function(){return t.apply(this,arguments)}}(),C=function(){var e=Object(d.a)(Object(l.a)().mark((function e(t,n){var r;return Object(l.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,r=new AbortController,g((function(e){return[].concat(Object(G.a)(e),[r])})),e.next=5,le(t,n.id,m);case 5:S(n),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(0),console.log(e.t0);case 11:case"end":return e.stop()}}),e,null,[[0,8]])})));return function(t,n){return e.apply(this,arguments)}}(),E=function(t){var n=function(){var e=new FormData;return e.append("title",f),e.append("choir_id",v),e}(),r=e.editableParts?e.editableParts.id:null,a=t.addSong(n,r);return g((function(e){return[].concat(Object(G.a)(e),[a])})),t.sendSong()},P=function(e){var t=[],n=a.get().map((function(e){return Object.assign({},e)})).reduce((function(n,r){var c=function(e){return e.pitch_order=a.findIndex("id",e.id),e.data()}(r);return t.push(e.addPart(c,r.id)),n.push(e.sendNextPart()),n}),[]);return g(t),n},I=function(){var t=Object(d.a)(Object(l.a)().mark((function t(){var n,r;return Object(l.a)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return w(a.get()),e.editableParts&&k(),n=de(m),t.prev=3,t.next=6,E(n);case 6:t.next=12;break;case 8:t.prev=8,t.t0=t.catch(3),e.setStatusInfo((function(e){return e.setFailure()})),console.log(t.t0);case 12:try{r=P(n)}catch(c){e.setStatusInfo((function(e){return e.setFailure()})),console.log(c)}r.forEach(function(){var e=Object(d.a)(Object(l.a)().mark((function e(t){return Object(l.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=S,e.next=3,t;case 3:e.t1=e.sent.name,(0,e.t0)(e.t1);case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());case 14:case"end":return t.stop()}}),t,null,[[3,8]])})));return function(){return t.apply(this,arguments)}}(),T=function(){window.confirm("Do you really want to delete this song?")&&N()};return Object(r.useEffect)((function(){return function(){return O.forEach((function(e){return e.abort()}))}})),Object(j.jsxs)("form",{className:"SongForm",onSubmit:function(t){t.preventDefault(),e.setStatusInfo((function(e){return e.setDelivery()})),I()},children:[Object(j.jsx)("div",{className:"title-bar",children:Object(j.jsx)("input",{type:"text",name:"title",className:"text-input song-title-input",placeholder:"Song Title",value:f,onChange:function(e){return b(e.target.value)},required:!0})}),Object(j.jsx)(te.a,{onDragEnd:function(e){var t=e.destination,n=e.source;t&&t.index!==n.index&&c((function(e){return e.move(n.index,t.index)}))},children:Object(j.jsx)(te.c,{droppableId:"partsList",children:function(e){return Object(j.jsxs)("ul",Object(o.a)(Object(o.a)({id:"parts-list",ref:e.innerRef},e.droppableProps),{},{children:[a.get().map((function(e,t){return Object(j.jsx)(re,{index:t,part:e,updatePart:y,removePart:x,noDrag:0===a.get().length},e.key)})),e.placeholder]}))}})}),Object(j.jsxs)("div",{className:"main-form-btns",children:[Object(j.jsx)("button",{type:"button",className:"pseudo-btn",id:"add-part-btn",onClick:function(){return c((function(e){return e.add(oe())}))},children:"Add Part"}),function(){if("edit"===e.statusInfo.factoryMode)return Object(j.jsx)("button",{type:"button",className:"pseudo-btn",onClick:T,children:"Delete Song"})}(),Object(j.jsx)("input",{type:"submit",className:"pseudo-btn",value:"new"===e.statusInfo.factoryMode?"Submit Song":"Update Song"})]})]})};n(88);var je=function(e){var t=function(){return"new"===e.loading.mode?{working:"Loading",finished:"Loaded"}:"edit"===e.loading.mode?{working:"Updating",finished:"Updated"}:"destroy"===e.loading.mode?{working:"Destroying",finished:"Destroyed"}:void 0};return Object(j.jsx)("div",{className:"PartLoadedEntry",children:Object(j.jsx)("span",{className:e.loading.success?"finished":"working",children:e.loading.success?"".concat(e.partName,": ").concat(t().finished):"".concat(e.partName,": ").concat(t().working)})})};n(89);var pe=function(e){return Object(j.jsxs)("div",{className:"SubmitProgress",children:[Object(j.jsx)("span",{className:"top-message",children:function(){switch(e.statusInfo.jobStatus){case"creating":return"Creating song...";case"updating":return"Updating song...";case"destroying":return"Destroying song...";default:return""}}()}),Object(j.jsxs)("div",{className:"progress-status",children:["delivery"===e.factoryMode?Object.entries(e.loadings).map((function(e){return Object(j.jsx)(je,{partName:e[0],loading:e[1]},"".concat(e[0],"-key"))})):"",Object(j.jsx)("span",{className:"report-message",children:function(){switch(e.statusInfo.jobStatus){case"submitted":return"Song successfully created!";case"updated":return"Song succesfully updated!";case"destroyed":return"Song successfully destroyed!";case"failedToCreate":return"Rats! Song creation could not be completed";case"failedToUpdate":return"Rats! Song could not be succesfully updated";case"failedToDestroy":return"Rats! Song could not be succesfully destroyed";default:return""}}()})]})]})};n(90);var he=function(e){var t=Object(r.useState)(e),n=Object(u.a)(t,2),a=n[0],c=n[1];return[a,function(e){c((function(t){var n=Object(o.a)({},t);return e(n),n}))}]};var Oe=function(){var e="none",t="idle";return{get jobStatus(){return e},set jobStatus(t){!function(e){if(!function(e){return"none"===e||"assembly"===e||"creating"===e||"created"===e||"failedToCreate"===e||"updating"===e||"updated"===e||"failedToUpdate"===e||"destroying"===e||"destroyed"===e||"failedToDestroy"===e}(e))throw new Error("".concat(e," is not a valid jobStatus"))}(t),e=t},get factoryMode(){return t},set factoryMode(e){!function(e){if(!function(e){return"new"===e||"idle"===e||"edit"===e||"delivery"===e||"destruction"===e}(e))throw new Error("".concat(e," is not a valid factoryMode"))}(e),t=e},isSuccessful:function(){return"created"===this.jobStatus||"updated"===this.jobStatus||"destroyed"===this.jobStatus},setFailure:function(){switch(this.jobStatus){case"creating":this.jobStatus="failedToCreate";break;case"updating":this.jobStatus="failedToUpdate";break;case"destroying":this.jobStatus="failedToDestroy";break;default:throw new Error("Cannot setFailure when job is not in progress (jobStatus: ".concat(this.jobStatus,")"))}this.factoryMode="idle"},setSuccess:function(){switch(this.jobStatus){case"creating":this.jobStatus="created";break;case"updating":this.jobStatus="updated";break;case"destroying":this.jobStatus="destroyed";break;default:throw new Error("Cannot setSuccess when job is not in progress (jobStatus: ".concat(this.jobStatus,")"))}this.factoryMode="idle"},setDelivery:function(){switch(this.factoryMode){case"new":this.jobStatus="creating";break;case"edit":this.jobStatus="updating";break;default:throw new Error("Cannot setDelivery when factoryMode is ".concat(this.factoryMode))}this.factoryMode="delivery"},setDestroy:function(){this.jobStatus="destroying",this.factoryMode="destruction"},isInProgress:function(){return"assembly"===this.jobStatus||"creating"===this.jobStatus||"updating"===this.jobStatus||"destroying"===this.jobStatus},reset:function(){this.factoryMode="idle",this.jobStatus="none"}}};var ge=function(e){var t=e.song,n=e.loadSongs,a=(e.closeEditor,Object(r.useState)({})),c=Object(u.a)(a,2),o=c[0],s=c[1],i=he(Oe()),f=Object(u.a)(i,2),b=f[0],p=f[1],h=Object(r.useState)([]),O=Object(u.a)(h,2),g=O[0],m=O[1],v=function(){var e=Object(d.a)(Object(l.a)().mark((function e(n){return Object(l.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=m,e.next=3,T(t.id,n.signal);case 3:e.t1=e.sent,(0,e.t0)(e.t1),p((function(e){e.factoryMode="new"===t.id?"new":"edit",e.jobStatus="assembly"}));case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();return Object(r.useEffect)((function(){var e=new AbortController;return t.id&&v(e),function(){return e.abort()}}),[]),Object(r.useEffect)((function(){var e=new AbortController;return b.isSuccessful()&&n(e),function(){return e.abort()}}),[b]),Object(r.useEffect)((function(){Object.values(o).every((function(e){return e.success}))&&Object.values(o).length>0&&p((function(e){return e.setSuccess()}))}),[o]),Object(j.jsx)("div",{className:"SongFactory",children:function(){switch(b.factoryMode){case"new":case"edit":return Object(j.jsx)(be,{statusInfo:b,setStatusInfo:p,setLoadings:s,editableSong:t,editableParts:g});case"delivery":case"destruction":return Object(j.jsx)(pe,{loadings:o,statusInfo:b});default:return}}()})};var me,ve,xe=function(e){var t=e.title;return Object(j.jsx)("span",{className:"TitleBar",children:t})},ye=V.a.li(me||(me=Object(K.a)(["\n    list-style: none;\n    border: 1px solid lightgray;\n    padding: 5px;\n    margin-bottom: 5px;\n    border-radius: 3px;\n    background-color: white;\n    cursor: pointer;\n  "]))),we=V.a.div(ve||(ve=Object(K.a)(["\n  float: right;\n"])));var Se=function(e){var t=e.song,n=e.isOpen,r=e.openCloseSwitch,a=e.loadSongs;return Object(j.jsxs)(ye,{className:"SongEditor",onClick:function(e){e.target.classList.contains("SongEditor")&&r(t.id)},children:[function(){if(n(t.id))return Object(j.jsx)(we,{onClick:function(){return r(t.id)},children:Object(j.jsx)(ee,{})})}(),n(t.id)?Object(j.jsx)(ge,{song:t,loadSongs:a}):Object(j.jsx)(xe,{title:t.title})]})};function ke(){return(ke=Object(d.a)(Object(l.a)().mark((function e(t,n,r){var a;return Object(l.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,P("".concat(k,"/choirs/").concat(t,"/edit"),"json",{headers:{Authorization:"Bearer ".concat(n)},signal:r});case 2:return a=e.sent,e.abrupt("return",a.songs);case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var Ne,Ce,Ee=function(e,t,n){return ke.apply(this,arguments)};var Pe=V.a.ul(Ne||(Ne=Object(K.a)(["\nwidth: 400px;\npadding: 50px;\nbackground-color: rgb(241, 236, 236);\n"]))),Ie=V.a.li(Ce||(Ce=Object(K.a)(["\n  list-style: none;\n  border: 1px solid lightgray;\n  padding: 5px;\n  margin-bottom: 5px;\n  border-radius: 3px;\n  background-color: white;\n  width: 15px;\n  float: right;\n  cursor: pointer;\n  "])));var Te=function(e){var t=e.choirId,n=Object(r.useState)([]),a=Object(u.a)(n,2),c=a[0],o=a[1],i=Object(r.useState)(null),f=Object(u.a)(i,2),b=f[0],p=f[1],h=Object(H.useErrorHandler)(),O=Object(r.useContext)(q),g=function(){var e=Object(d.a)(Object(l.a)().mark((function e(n){var r;return Object(l.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,Ee(t,O,n.signal);case 3:r=e.sent,o(r),p(null),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(0),h(e.t0);case 11:case"end":return e.stop()}}),e,null,[[0,8]])})));return function(t){return e.apply(this,arguments)}}(),m=function(e){return b===e},v=function(e){"new"===b&&o((function(t){return function(e,t,n){var r=Object(G.a)(e),a=e.findIndex((function(e){return e[t]===n}));return r.splice(a,1),r}(t,e,"new")})),m(e)?p(null):p(e)};return Object(r.useEffect)((function(){var e=new AbortController;return g(e),function(){return e.abort()}}),[]),Object(j.jsxs)("div",{className:"EditSongs",children:[Object(j.jsx)(s.b,{to:".",children:Object(j.jsx)("button",{className:"nav-btn",children:"Home"})}),Object(j.jsxs)(Pe,{children:[c.map((function(e){return Object(j.jsx)(Se,{song:e,isOpen:m,openCloseSwitch:v,loadSongs:g},e.id)})),Object(j.jsx)(Ie,{onClick:function(){var e={id:"new"};p("new"),o((function(t){return[].concat(Object(G.a)(t),[e])}))},children:"+"})]})]})};var De=function(){var e=Object(r.useState)(function(){try{return localStorage.getItem("token")}catch(e){return console.log("Couldn't find token"),null}}()),t=Object(u.a)(e,2),n=t[0],a=t[1],c=Object(i.g)().choirId;return Object(j.jsx)("div",{className:"Choir",children:Object(j.jsx)(R.Provider,{value:c,children:Object(j.jsxs)(i.d,{children:[Object(j.jsx)(i.b,{exact:!0,path:"/choir/:choirId",component:_}),Object(j.jsx)(i.b,{path:"/choir/:choirId/edit",render:function(e){return Object(j.jsx)(J,Object(o.a)(Object(o.a)({},e),{},{token:n,setToken:a,targetPath:"./choir/".concat(c,"/edit"),children:Object(j.jsx)(Te,{choirId:c})}))}})]})})})},Ae=n(14);function Fe(){return(Fe=Object(d.a)(Object(l.a)().mark((function e(t,n,r){var a;return Object(l.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(a=new FormData).append("password",n),a.append("username",t),e.next=5,P("".concat(k,"/admins/login"),"json",{method:"post",body:a,timeout:4e3,abortSignal:r});case 5:return e.abrupt("return",e.sent);case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var Me=function(e,t,n){return Fe.apply(this,arguments)};n(91);var ze=function(e){var t=Object(r.useState)(!1),n=Object(u.a)(t,2),a=n[0],c=n[1],s=Object(r.useState)(!1),l=Object(u.a)(s,2),d=l[0],f=l[1],b=Object(r.useState)({username:"",password:""}),p=Object(u.a)(b,2),h=p[0],O=p[1],g=function(e){O(Object(o.a)(Object(o.a)({},h),{},Object(Ae.a)({},e.target.name,e.target.value)))};return a?Object(j.jsx)(i.a,{to:e.location.state.targetPath}):Object(j.jsxs)("div",{className:"Login central-container",children:[Object(j.jsx)("span",{id:"incorrect-credentials-message",children:d?"Either the username or the password is incorrect":""}),Object(j.jsxs)("form",{onSubmit:function(t){t.preventDefault(),Me(h.username,h.password).then((function(t){!function(e){try{localStorage.setItem("token",e)}catch(t){}}(t.token),e.location.state.setToken(t.token),c(!0)})).catch((function(t){console.log(e.location),t.isUnauthorized?f(!0):console.log(t)}))},children:[Object(j.jsx)("label",{htmlFor:"username",children:"Username"}),Object(j.jsx)("input",{type:"text",id:"username",name:"username",className:"text-input",value:h.username,onChange:g,required:!0}),Object(j.jsx)("label",{htmlFor:"password",children:"Password"}),Object(j.jsx)("input",{type:"password",id:"password",name:"password",className:"text-input",value:h.password,onChange:g,required:!0}),Object(j.jsx)("input",{type:"submit",className:"pseudo-btn",value:"Log in"})]})]})};n(92);var Be=function(){return Object(j.jsx)(s.a,{children:Object(j.jsxs)(i.d,{children:[Object(j.jsx)(i.b,{path:"/login",render:function(e){return Object(j.jsx)(ze,Object(o.a)({},e))}}),Object(j.jsx)(i.b,{path:"/choir/:choirId",component:De})]})})};c.a.render(Object(j.jsx)(Be,{}),document.getElementById("root"))}},[[94,1,2]]]);
//# sourceMappingURL=main.cb238a54.chunk.js.map